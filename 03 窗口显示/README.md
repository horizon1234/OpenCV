# è¯¾ç¨‹ 03ï¼šçª—å£æ˜¾ç¤ºä¸é¼ æ ‡äº¤äº’ï¼ˆcv::namedWindowï¼‰

> é€‚åˆäººç¾¤ï¼šé›¶åŸºç¡€åˆå­¦è€… | é¢„è®¡é˜…è¯»æ—¶é—´ï¼š30 åˆ†é’Ÿ

---

## é›¶ã€é¢„å¤‡çŸ¥è¯†

### Qt çª—å£ vs OpenCV çª—å£

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œè¯¾ç¨‹ 01 å’Œ 02 éƒ½æ˜¯åœ¨ Qt çš„ `QLabel` é‡Œæ˜¾ç¤ºå›¾ç‰‡ã€‚ä½† OpenCV ä¹Ÿæœ‰**è‡ªå·±çš„çª—å£ç³»ç»Ÿ**â€”â€”`namedWindow` + `imshow`ã€‚

```
ä¸¤ç§æ˜¾ç¤ºæ–¹å¼å¯¹æ¯”ï¼š

  Qt æ–¹å¼ï¼ˆä¹‹å‰ç”¨çš„ï¼‰ï¼š
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Qt ä¸»çª—å£                   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  QLabelï¼ˆæ˜¾ç¤ºå›¾ç‰‡ï¼‰     â”‚  â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
  â”‚  â”‚  â”‚    ğŸ± å›¾ç‰‡      â”‚  â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚  [æŒ‰é’®1] [æŒ‰é’®2]            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  å›¾ç‰‡åµŒåœ¨ Qt ç•Œé¢é‡Œ

  OpenCV æ–¹å¼ï¼ˆæœ¬è¯¾ä½¿ç”¨ï¼‰ï¼š
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Qt ä¸»çª—å£    â”‚    â”‚ OpenCV çª—å£   â”‚
  â”‚  [æ‰“å¼€å¹¶æ˜¾ç¤º] â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
  â”‚              â”‚    â”‚ â”‚  ğŸ± å›¾ç‰‡ â”‚ â”‚
  â”‚              â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
  â”‚              â”‚    â”‚ [Trackbar]   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  æ§åˆ¶æŒ‰é’®åœ¨ Qt é‡Œ      å›¾ç‰‡åœ¨ç‹¬ç«‹çš„ OpenCV çª—å£æ˜¾ç¤º
```

**ä¸ºä»€ä¹ˆè¦ç”¨ OpenCV çª—å£ï¼Ÿ**

| ç‰¹æ€§ | Qt æ˜¾ç¤º | OpenCV çª—å£ |
|------|---------|------------|
| éœ€è¦çš„ä»£ç é‡ | å¤šï¼ˆMatâ†’QImageâ†’QPixmapâ†’QLabelï¼‰ | å°‘ï¼ˆ`imshow` ä¸€è¡Œæå®šï¼‰ |
| æ‹–æ‹½ç¼©æ”¾ | éœ€è¦è‡ªå·±å®ç° | å†…å»ºæ”¯æŒ |
| å†…å»ºæ»‘åŠ¨æ¡ | æ²¡æœ‰ | `createTrackbar` |
| é¼ æ ‡å›è°ƒ | éœ€è¦é‡å†™ Qt äº‹ä»¶ | `setMouseCallback` |
| å®æ—¶æ›´æ–° | éœ€è¦æ‰‹åŠ¨åˆ·æ–° | `imshow` è‡ªåŠ¨åˆ·æ–° |
| é€‚åˆåœºæ™¯ | å‘å¸ƒäº§å“çº§ UI | å¼€å‘è°ƒè¯•ã€å¿«é€Ÿå®éªŒ |

---

## ä¸€ã€æœ¬è¯¾ç›®æ ‡

æœ¬è¯¾ä½ å°†å­¦ä¼šï¼š

1. **åˆ›å»ºå’Œç®¡ç† OpenCV çª—å£**ï¼ˆ`namedWindow`, `imshow`, `destroyWindow`ï¼‰
2. **è®¾ç½®é¼ æ ‡å›è°ƒ**åœ¨å›¾ç‰‡ä¸Šç”»ç”»ï¼ˆ`setMouseCallback`ï¼‰
3. ç†è§£ **`waitKey` çš„ä½œç”¨**ï¼ˆäº‹ä»¶å¾ªç¯ï¼‰
4. åœ¨ Qt åº”ç”¨ä¸­**é›†æˆ OpenCV çª—å£**çš„æ³¨æ„äº‹é¡¹

---

## äºŒã€OpenCV çª—å£ç³»ç»Ÿè¯¦è§£

### 2.1 namedWindow

```cpp
cv::namedWindow(const std::string& winname, 
                int flags = cv::WINDOW_AUTOSIZE);
```

| å‚æ•° | å«ä¹‰ | å¸¸ç”¨å€¼ |
|------|------|--------|
| `winname` | çª—å£åç§°ï¼ˆåŒæ—¶ä¹Ÿæ˜¯çª—å£çš„å”¯ä¸€æ ‡è¯†ï¼‰ | `"My Window"` |
| `flags` | çª—å£å±æ€§ | `WINDOW_AUTOSIZE`, `WINDOW_NORMAL` |

**çª—å£æ ‡å¿—è¯¦è§£**ï¼š

| æ ‡å¿— | æ•ˆæœ | é€‚åˆåœºæ™¯ |
|------|------|---------|
| `WINDOW_AUTOSIZE` | çª—å£å¤§å°å›ºå®š = å›¾ç‰‡å¤§å°ï¼Œä¸èƒ½æ‰‹åŠ¨ç¼©æ”¾ | å›¾ç‰‡ä¸å¤§æ—¶ |
| `WINDOW_NORMAL` | å¯ä»¥è‡ªç”±ç¼©æ”¾çª—å£å¤§å° | å¤§å›¾ã€éœ€è¦ç¼©æ”¾è§‚å¯Ÿ |
| `WINDOW_FULLSCREEN` | å…¨å±æ˜¾ç¤º | æ¼”ç¤ºå±•ç¤º |
| `WINDOW_GUI_EXPANDED` | æ‰©å±• GUIï¼ˆçŠ¶æ€æ ç­‰ï¼‰ | éœ€è¦æ›´å¤šä¿¡æ¯ |

```
WINDOW_AUTOSIZE vs WINDOW_NORMALï¼š

  WINDOW_AUTOSIZE:              WINDOW_NORMAL:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                  â”‚          â”‚ å›¾ç‰‡ç¼©å°   â”‚
  â”‚  å›¾ç‰‡å¤šå¤§        â”‚          â”‚ é€‚åº”çª—å£   â”‚
  â”‚  çª—å£å°±å¤šå¤§      â”‚          â”‚           â”‚
  â”‚                  â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚  ä¸èƒ½æ‹–è¾¹æ¡†ç¼©æ”¾  â”‚          å¯ä»¥æ‹–è¾¹æ¡†ç¼©æ”¾
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 imshow

```cpp
cv::imshow(const std::string& winname, const cv::Mat& mat);
```

```
imshow çš„å·¥ä½œæµç¨‹ï¼š

  1. æ£€æŸ¥çª—å£ winname æ˜¯å¦å­˜åœ¨
     â””â”€ ä¸å­˜åœ¨ â†’ è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªï¼ˆç­‰æ•ˆäºå…ˆè°ƒ namedWindowï¼‰
     â””â”€ å­˜åœ¨   â†’ æ›´æ–°æ˜¾ç¤ºå†…å®¹
     
  2. å°† Mat æ•°æ®å‘é€ç»™ GUI åç«¯ï¼ˆå¦‚ GTK / Qtï¼‰
  
  3. çª—å£æ›´æ–°ç”»é¢
     â””â”€ ä½†æ³¨æ„ï¼šç”»é¢ä¸ä¼šç«‹åˆ»åˆ·æ–°ï¼
        éœ€è¦ waitKey() æ‰èƒ½å¤„ç† GUI äº‹ä»¶å¹¶åˆ·æ–°
```

### 2.3 waitKey â€”â€” æœ€å®¹æ˜“è¯¯è§£çš„å‡½æ•°

```cpp
int key = cv::waitKey(int delay = 0);
```

| å‚æ•° | å«ä¹‰ |
|------|------|
| `delay = 0` | **æ— é™ç­‰å¾…**ï¼Œç›´åˆ°ç”¨æˆ·æŒ‰ä¸‹ä»»æ„é”® |
| `delay > 0` | ç­‰å¾… delay æ¯«ç§’ï¼Œè¶…æ—¶åˆ™è¿”å› -1 |
| è¿”å›å€¼ | æŒ‰ä¸‹çš„é”®çš„ ASCII ç ï¼Œæˆ– -1ï¼ˆè¶…æ—¶ï¼‰ |

**ä¸ºä»€ä¹ˆ imshow åå¿…é¡»è°ƒ waitKeyï¼Ÿ**

```
æ²¡æœ‰ waitKeyï¼š              æœ‰ waitKeyï¼š
  imshow() â†’ æ•°æ®é€å‡º       imshow() â†’ æ•°æ®é€å‡º
  â†’ æ²¡äººå¤„ç† GUI äº‹ä»¶        â†’ waitKey() å¤„ç† GUI äº‹ä»¶
  â†’ çª—å£ä¸åˆ·æ–°ï¼             â†’ çª—å£åˆ·æ–° âœ“
  â†’ ç”»é¢åœç•™åœ¨ä¹‹å‰çš„         â†’ æ˜¾ç¤ºæœ€æ–°çš„å›¾ç‰‡ âœ“
```

> `waitKey` ä¸åªæ˜¯"ç­‰å¾…æŒ‰é”®"â€”â€”å®ƒæ›´é‡è¦çš„ä½œç”¨æ˜¯**å¤„ç† GUI äº‹ä»¶é˜Ÿåˆ—**ï¼ˆçª—å£é‡ç»˜ã€é¼ æ ‡ç§»åŠ¨ç­‰ï¼‰ã€‚å¦‚æœä½ ä¸è°ƒç”¨å®ƒï¼ŒOpenCV çª—å£å°±æ˜¯ä¸€ä¸ª"æ­»"çª—å£ã€‚

**åœ¨ Qt ç¨‹åºä¸­çš„ç‰¹æ®Šå¤„ç†**ï¼šç”±äº Qt æœ‰è‡ªå·±çš„äº‹ä»¶å¾ªç¯ï¼Œæˆ‘ä»¬ç”¨ `QTimer` å®šæœŸè°ƒç”¨ `waitKey(1)`ï¼š

```cpp
waitKeyTimer = new QTimer(this);
waitKeyTimer->setInterval(30);  // æ¯ 30ms è°ƒç”¨ä¸€æ¬¡
connect(waitKeyTimer, &QTimer::timeout, this, []() {
    cv::waitKey(1);  // å¤„ç† OpenCV çª—å£äº‹ä»¶
});
```

---

## ä¸‰ã€é¼ æ ‡å›è°ƒæœºåˆ¶

### 3.1 setMouseCallback

```cpp
cv::setMouseCallback(const std::string& winname,       // çª—å£å
                     cv::MouseCallback onMouse,         // å›è°ƒå‡½æ•°
                     void* userdata = nullptr);         // ç”¨æˆ·æ•°æ®
```

**ä»€ä¹ˆæ˜¯"å›è°ƒå‡½æ•°"ï¼Ÿ**

```
æ™®é€šå‡½æ•°è°ƒç”¨ï¼š       ä½ ä¸»åŠ¨è°ƒç”¨å‡½æ•°
  ä½  â”€â”€â”€â”€â”€â”€â–¶ å‡½æ•°()

å›è°ƒå‡½æ•°ï¼š           ä½ æ³¨å†Œå‡½æ•°ï¼Œç³»ç»Ÿåœ¨äº‹ä»¶å‘ç”Ÿæ—¶è°ƒç”¨
  ä½  â”€â”€â–¶ "å˜¿ç³»ç»Ÿï¼Œé¼ æ ‡ä¸€åŠ¨å°±å¸®æˆ‘è°ƒ myFunc"
  ç³»ç»Ÿ â”€â”€â–¶ ç­‰å¾…...
  ç”¨æˆ·ç§»åŠ¨é¼ æ ‡ â”€â”€â–¶ ç³»ç»Ÿ â”€â”€â–¶ myFunc(event, x, y, flags)
                                    â†‘
                                  ç³»ç»Ÿå¸®ä½ è°ƒçš„
```

å›è°ƒå‡½æ•°çš„ç­¾åå¿…é¡»æ˜¯ï¼š

```cpp
void myCallback(int event, int x, int y, int flags, void* userdata);
```

| å‚æ•° | å«ä¹‰ | ç¤ºä¾‹ |
|------|------|------|
| `event` | é¼ æ ‡äº‹ä»¶ç±»å‹ | `EVENT_MOUSEMOVE`, `EVENT_LBUTTONDOWN` |
| `x, y` | é¼ æ ‡åœ¨å›¾ç‰‡ä¸­çš„åæ ‡ | (100, 200) |
| `flags` | é™„åŠ æ ‡å¿—ï¼ˆå“ªäº›é”®/æŒ‰é’®åŒæ—¶æŒ‰ä¸‹ï¼‰ | `EVENT_FLAG_CTRLKEY` |
| `userdata` | ä½ ä¼ å…¥çš„è‡ªå®šä¹‰æ•°æ®æŒ‡é’ˆ | `this`ï¼ˆä¼ å…¥ widget æŒ‡é’ˆï¼‰ |

### 3.2 é¼ æ ‡äº‹ä»¶ç±»å‹

| äº‹ä»¶ | å¸¸é‡ | è§¦å‘æ¡ä»¶ |
|------|------|---------|
| é¼ æ ‡ç§»åŠ¨ | `EVENT_MOUSEMOVE` | é¼ æ ‡åœ¨çª—å£å†…ç§»åŠ¨ |
| å·¦é”®æŒ‰ä¸‹ | `EVENT_LBUTTONDOWN` | æŒ‰ä¸‹å·¦é”®çš„ç¬é—´ |
| å·¦é”®æŠ¬èµ· | `EVENT_LBUTTONUP` | æ¾å¼€å·¦é”®çš„ç¬é—´ |
| å·¦é”®åŒå‡» | `EVENT_LBUTTONDBLCLK` | å¿«é€ŸåŒå‡»å·¦é”® |
| å³é”®æŒ‰ä¸‹ | `EVENT_RBUTTONDOWN` | æŒ‰ä¸‹å³é”® |
| å³é”®æŠ¬èµ· | `EVENT_RBUTTONUP` | æ¾å¼€å³é”® |
| ä¸­é”®æŒ‰ä¸‹ | `EVENT_MBUTTONDOWN` | æŒ‰ä¸‹ä¸­é”®ï¼ˆæ»šè½®ï¼‰ |
| æ»šè½®æ»šåŠ¨ | `EVENT_MOUSEWHEEL` | æ»šåŠ¨é¼ æ ‡æ»šè½® |

**é¼ æ ‡äº‹ä»¶çš„å…¸å‹è§¦å‘åºåˆ—**ï¼š

```
åœºæ™¯ 1ï¼šå•å‡»
  LBUTTONDOWN â†’ LBUTTONUP
  
åœºæ™¯ 2ï¼šæ‹–æ‹½ç”»çº¿
  LBUTTONDOWN â†’ MOUSEMOVE â†’ MOUSEMOVE â†’ ... â†’ LBUTTONUP
  
åœºæ™¯ 3ï¼šåŒå‡»
  LBUTTONDOWN â†’ LBUTTONUP â†’ LBUTTONDBLCLK â†’ LBUTTONUP
  
åœºæ™¯ 4ï¼šå³é”®èœå•
  RBUTTONDOWN â†’ RBUTTONUP
```

| flags æ ‡å¿— | å«ä¹‰ | ç”¨é€” |
|-----------|------|------|
| `EVENT_FLAG_LBUTTON` | å·¦é”®æ­£è¢«æŒ‰ä½ | åˆ¤æ–­æ‹–æ‹½çŠ¶æ€ |
| `EVENT_FLAG_RBUTTON` | å³é”®æ­£è¢«æŒ‰ä½ | ç»„åˆæ“ä½œ |
| `EVENT_FLAG_CTRLKEY` | Ctrl é”®è¢«æŒ‰ä½ | ä¿®é¥°é”®+é¼ æ ‡ç»„åˆ |
| `EVENT_FLAG_SHIFTKEY` | Shift é”®è¢«æŒ‰ä½ | æ©¡çš®æ“¦ç­‰åŠŸèƒ½ |
| `EVENT_FLAG_ALTKEY` | Alt é”®è¢«æŒ‰ä½ | å…¶ä»–ç»„åˆ |

### 3.3 ç”¨é¼ æ ‡åœ¨å›¾ç‰‡ä¸Šç”»çº¿

æœ¬è¯¾çš„æ ¸å¿ƒåŠŸèƒ½â€”â€”æ‹–æ‹½é¼ æ ‡åœ¨å›¾ç‰‡ä¸Šç”»çº¿ã€‚åŸç†æ˜¯ï¼š

```
ç”»çº¿çš„çŠ¶æ€æœºï¼š

  [ç­‰å¾…æŒ‰ä¸‹] â”€â”€â”€â”€ å·¦é”®æŒ‰ä¸‹ â”€â”€â”€â”€â–¶ [æ­£åœ¨ç”»çº¿]
       â–²                           â”‚
       â”‚                           â”‚ é¼ æ ‡ç§»åŠ¨ï¼š
       â”‚                           â”‚ cv::line(ä¸Šä¸€ç‚¹, å½“å‰ç‚¹)
       â”‚                           â”‚
       â””â”€â”€â”€â”€ å·¦é”®æŠ¬èµ· â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  æ—¶åºå›¾ï¼š
  
  æ—¶é—´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
  
  æŒ‰ä¸‹        ç§»åŠ¨    ç§»åŠ¨    ç§»åŠ¨    æŠ¬èµ·
   â–¼          â–¼       â–¼       â–¼       â–¼
   P0 â”€â”€â”€â”€â”€ P1 â”€â”€â”€â”€ P2 â”€â”€â”€â”€ P3       åœæ­¢
   â”‚         â”‚       â”‚       â”‚
   â””â”€ line â”€â”€â”˜â”€ lineâ”€â”˜â”€ lineâ”€â”˜
   
  æ¯æ¬¡ç§»åŠ¨éƒ½ç”»ä¸€å°æ®µçº¿ï¼ˆP0â†’P1, P1â†’P2, P2â†’P3ï¼‰
  å¤šä¸ªå°çº¿æ®µè¿èµ·æ¥ = æµç•…çš„æ‰‹ç»˜çº¿æ¡
```

å…³é”®ä»£ç ï¼š

```cpp
void handleMouseEvent(int event, int x, int y, int flags)
{
    const cv::Point currentPoint(x, y);

    if (event == cv::EVENT_LBUTTONDOWN)
    {
        isDrawing = true;            // å¼€å§‹ç”»çº¿
        lastPoint = currentPoint;     // è®°å½•èµ·ç‚¹
        return;
    }

    if (event == cv::EVENT_MOUSEMOVE && isDrawing)
    {
        // ä»ä¸Šä¸€ä¸ªç‚¹ç”»çº¿åˆ°å½“å‰ç‚¹
        cv::line(displayImage, lastPoint, currentPoint, 
                 brushColor, brushThickness, cv::LINE_AA);
        lastPoint = currentPoint;     // æ›´æ–°èµ·ç‚¹
        cv::imshow(windowName, displayImage);  // åˆ·æ–°æ˜¾ç¤º
        return;
    }

    if (event == cv::EVENT_LBUTTONUP)
    {
        isDrawing = false;            // åœæ­¢ç”»çº¿
    }
}
```

### 3.4 cv::line å‡½æ•°

```cpp
cv::line(cv::Mat& img,        // è¦ç”»çº¿çš„å›¾ç‰‡
         cv::Point pt1,       // èµ·ç‚¹
         cv::Point pt2,       // ç»ˆç‚¹
         const cv::Scalar& color,  // é¢œè‰² (B, G, R)
         int thickness = 1,        // çº¿å®½
         int lineType = LINE_8);   // çº¿å‹
```

çº¿å‹å¯¹æ¯”ï¼š

```
LINE_8ï¼ˆ8-è¿é€šï¼Œé»˜è®¤ï¼‰ï¼š     LINE_AAï¼ˆæŠ—é”¯é½¿ï¼‰ï¼š
  â–ˆâ–ˆ                          â–ˆâ–ˆ
    â–ˆâ–ˆ                        â–‘â–ˆâ–ˆ
      â–ˆâ–ˆ                      â–‘â–‘â–ˆâ–ˆ
        â–ˆâ–ˆ                      â–‘â–ˆâ–ˆ
          â–ˆâ–ˆ                      â–ˆâ–ˆ
  é”¯é½¿æ˜æ˜¾                    è¾¹ç¼˜å¹³æ»‘ï¼ˆæ¨èï¼‰
```

**OpenCV å¸¸ç”¨ç»˜å›¾å‡½æ•°å‚è€ƒè¡¨**ï¼š

| å‡½æ•° | åŠŸèƒ½ | å…³é”®å‚æ•° | ç¤ºä¾‹ |
|------|------|---------|------|
| `cv::line` | ç”»ç›´çº¿ | pt1, pt2, color, thickness | `line(img, {0,0}, {100,100}, {0,0,255}, 2)` |
| `cv::circle` | ç”»åœ† | center, radius | `circle(img, {50,50}, 30, {255,0,0}, 2)` |
| `cv::rectangle` | ç”»çŸ©å½¢ | pt1, pt2ï¼ˆå¯¹è§’ï¼‰ | `rectangle(img, {10,10}, {90,90}, {0,255,0})` |
| `cv::ellipse` | ç”»æ¤­åœ† | center, axes, angle | `ellipse(img, {50,50}, {40,20}, 0, ...)` |
| `cv::putText` | å†™æ–‡å­— | text, org, fontFace | `putText(img, "Hi", {10,30}, FONT_..., 1.0, ...)` |
| `cv::polylines` | ç”»å¤šè¾¹å½¢ | pts, isClosed | `polylines(img, pts, true, {0,0,255})` |
| `cv::fillPoly` | å¡«å……å¤šè¾¹å½¢ | pts | `fillPoly(img, pts, {0,255,0})` |

> `thickness = -1` è¡¨ç¤ºå¡«å……ï¼ˆé€‚ç”¨äº circleã€rectangleï¼‰ã€‚
> `lineType = LINE_AA` å¼€å¯æŠ—é”¯é½¿ï¼Œæ¨èç”¨äºæ‰€æœ‰ç»˜å›¾ã€‚

**waitKey delay å€¼ç”¨æ³•å¯¹ç…§è¡¨**ï¼š

| delay å€¼ | è¡Œä¸º | å…¸å‹åœºæ™¯ |
|----------|------|---------|
| `0` | æ— é™ç­‰å¾…æŒ‰é”® | é™æ€å›¾æ•°è°ƒè¯•ï¼Œç­‰ç”¨æˆ·ç¡®è®¤ |
| `1` | ç­‰å¾… 1msï¼ˆå‡ ä¹ä¸ç­‰ï¼‰ | Qt ç¨‹åºä¸­é…åˆ QTimer |
| `30~33` | ~30fps | è§†é¢‘æ’­æ”¾ (30fps) |
| `16~17` | ~60fps | æµç•…åŠ¨ç”» (60fps) |
| `100+` | æ…¢é€Ÿæ’­æ”¾ | é€å¸§è°ƒè¯•ã€æ…¢æ”¾è§†é¢‘ |

---

## å››ã€OpenCV GUI åç«¯

### 4.1 ä»€ä¹ˆæ˜¯ GUI åç«¯ï¼Ÿ

OpenCV çš„çª—å£ç³»ç»Ÿä¸æ˜¯è‡ªå·±ä»å¤´å®ç°çš„ï¼Œè€Œæ˜¯ä¾èµ–åº•å±‚çš„ **GUI åº“**ï¼š

```
OpenCV çª—å£ APIï¼ˆä½ è°ƒç”¨çš„æ¥å£ï¼‰
       â”‚
       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ GUI åç«¯é€‰æ‹© â”‚
  â”‚ï¼ˆç¼–è¯‘æ—¶å†³å®šï¼‰â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
  â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
  â–¼    â–¼        â–¼
 GTK  Qt    Win32
(Linux) (è·¨å¹³å°) (Windows)
```

| åç«¯ | å¹³å° | ç‰¹ç‚¹ |
|------|------|------|
| GTK 2/3 | Linux | æœ€å¸¸ç”¨ï¼ŒUbuntu é»˜è®¤ |
| Qt | è·¨å¹³å° | åŠŸèƒ½æœ€ä¸°å¯Œï¼ˆæ‰©å±• GUIï¼‰ |
| Win32 | Windows | Windows åŸç”Ÿ |
| Cocoa | macOS | macOS åŸç”Ÿ |

ä½ å¯ä»¥é€šè¿‡ä»£ç æ£€æŸ¥å½“å‰çš„ GUI åç«¯ï¼š

```cpp
std::string info = cv::getBuildInformation();
// åœ¨è¾“å‡ºä¸­æœç´¢ "GUI:" è¡Œ
```

### 4.2 åœ¨ Qt åº”ç”¨ä¸­ä½¿ç”¨ OpenCV çª—å£çš„æ³¨æ„äº‹é¡¹

```
âš ï¸ æ³¨æ„äº‹é¡¹ï¼š

  1. Qt å’Œ OpenCV éƒ½æœ‰äº‹ä»¶å¾ªç¯ï¼Œä¸èƒ½å†²çª
     â†’ ç”¨ QTimer + waitKey(1) è€Œä¸æ˜¯ waitKey(0)
  
  2. OpenCV é¼ æ ‡å›è°ƒå¯èƒ½åœ¨ä¸åŒçº¿ç¨‹è§¦å‘
     â†’ ç”¨ QMetaObject::invokeMethod åˆ‡å›ä¸»çº¿ç¨‹
  
  3. å…³é—­ OpenCV çª—å£ä¸ä¼šè‡ªåŠ¨æ¸…ç†
     â†’ é€‚å½“æ—¶æœºè°ƒç”¨ cv::destroyWindow()
```

---

## äº”ã€å®Œæ•´ä»£ç ç»“æ„

```
NamedWindowLessonWidget çš„å®Œæ•´äº¤äº’æµç¨‹ï¼š

  â”Œâ”€â”€â”€ Qt ç•Œé¢ â”€â”€â”€â”        â”Œâ”€â”€â”€ OpenCV çª—å£ â”€â”€â”€â”
  â”‚               â”‚        â”‚                   â”‚
  â”‚ [æ‰“å¼€å¹¶æ˜¾ç¤º]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ namedWindow()      â”‚
  â”‚               â”‚        â”‚ imshow(image)      â”‚
  â”‚               â”‚        â”‚ setMouseCallback() â”‚
  â”‚ [æ¸…ç©ºç”»å¸ƒ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ imshow(original)   â”‚
  â”‚               â”‚        â”‚                   â”‚
  â”‚ [çº¢è‰²][ç»¿è‰²]  â”‚        â”‚ é¼ æ ‡äº‹ä»¶ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â–¶ onMouseCallback
  â”‚ [è“è‰²]       â”‚        â”‚                   â”‚        â”‚
  â”‚ æ”¹å˜ç”»ç¬”é¢œè‰²  â”‚        â”‚                   â”‚        â”‚
  â”‚               â”‚        â”‚ cv::line() â—€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚ ç²—ç»†æ»‘å—      â”‚        â”‚ imshow(updated)   â”‚
  â”‚               â”‚        â”‚                   â”‚
  â”‚ QTimer 30ms â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ waitKey(1)         â”‚
  â”‚               â”‚        â”‚ å¤„ç† GUI äº‹ä»¶      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å…­ã€åŠ¨æ‰‹å®éªŒ

### å®éªŒ 1ï¼šæ·»åŠ å½¢çŠ¶ç»˜åˆ¶

```cpp
// åœ¨å³é”®æŒ‰ä¸‹æ—¶ç”»åœ†
if (event == cv::EVENT_RBUTTONDOWN) {
    cv::circle(displayImage, currentPoint, 20, brushColor, brushThickness, cv::LINE_AA);
    cv::imshow(windowName, displayImage);
}

// åœ¨ä¸­é”®æŒ‰ä¸‹æ—¶ç”»çŸ©å½¢
if (event == cv::EVENT_MBUTTONDOWN) {
    cv::rectangle(displayImage, 
                  cv::Point(x-30, y-20), cv::Point(x+30, y+20),
                  brushColor, brushThickness, cv::LINE_AA);
    cv::imshow(windowName, displayImage);
}
```

### å®éªŒ 2ï¼šæ©¡çš®æ“¦åŠŸèƒ½

```cpp
// æŒ‰ä½ Shift + æ‹–æ‹½ = æ“¦é™¤ï¼ˆç”¨åŸå›¾é¢œè‰²è¦†ç›–ï¼‰
if (event == cv::EVENT_MOUSEMOVE && isDrawing) {
    if (flags & cv::EVENT_FLAG_SHIFTKEY) {
        // æ©¡çš®æ“¦ï¼šä»åŸå›¾å¤åˆ¶ä¸€å—åŒºåŸŸ
        cv::Rect roi(x-10, y-10, 20, 20);
        roi &= cv::Rect(0, 0, displayImage.cols, displayImage.rows); // è£å‰ªåˆ°è¾¹ç•Œå†…
        originalImage(roi).copyTo(displayImage(roi));
    } else {
        cv::line(displayImage, lastPoint, currentPoint, brushColor, brushThickness, cv::LINE_AA);
    }
    lastPoint = currentPoint;
    cv::imshow(windowName, displayImage);
}
```

---

## ä¸ƒã€å¸¸è§é—®é¢˜

| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ³• |
|------|------|---------|
| çª—å£å¼¹ä¸å‡ºæ¥ | SSH è¿œç¨‹æ²¡å¼€ X11 è½¬å‘ | ç”¨ `ssh -X` æˆ– `ssh -Y` è¿æ¥ |
| çª—å£æ˜¾ç¤ºé»‘å± | æ²¡è°ƒç”¨ waitKey | ç¡®ä¿ QTimer åœ¨è¿è¡Œå¹¶è°ƒç”¨ waitKey(1) |
| ç”»çº¿æœ‰å»¶è¿Ÿ/å¡é¡¿ | waitKey é—´éš”å¤ªå¤§ | å‡å° QTimer é—´éš”ï¼ˆå¦‚ 16ms â‰ˆ 60fpsï¼‰ |
| å›è°ƒå‡½æ•°å´©æºƒ | è·¨çº¿ç¨‹è®¿é—® Qt å¯¹è±¡ | ç”¨ QMetaObject::invokeMethod(Qt::QueuedConnection) |
| ç”»å¸ƒæ¸…ç©ºæ— æ•ˆ | clone äº†æ—§çš„ displayImage | ç¡®ä¿ç”¨ `originalImage.clone()` |

---

## å…«ã€æœ¯è¯­è¡¨

| æœ¯è¯­ | è‹±æ–‡ | å«ä¹‰ |
|------|------|------|
| å‘½åçª—å£ | namedWindow | OpenCV åˆ›å»ºçš„ç‹¬ç«‹æ˜¾ç¤ºçª—å£ |
| å›è°ƒå‡½æ•° | Callback | æ³¨å†Œåç”±ç³»ç»Ÿåœ¨äº‹ä»¶è§¦å‘æ—¶è‡ªåŠ¨è°ƒç”¨çš„å‡½æ•° |
| äº‹ä»¶å¾ªç¯ | Event Loop | ä¸æ–­ç›‘å¬å’Œå¤„ç†ç”¨æˆ·äº¤äº’äº‹ä»¶çš„å¾ªç¯ |
| æŠ—é”¯é½¿ | Anti-Aliasing | ä½¿çº¿æ¡/è¾¹ç¼˜çœ‹èµ·æ¥å¹³æ»‘è€Œéé”¯é½¿çŠ¶ |
| GUI åç«¯ | GUI Backend | è´Ÿè´£å®é™…åˆ›å»ºçª—å£å’Œå¤„ç†è¾“å…¥çš„åº•å±‚åº“ |
| ç”»å¸ƒ | Canvas | å¯ä»¥åœ¨ä¸Šé¢ç»˜åˆ¶çš„å›¾åƒ |

---

## ä¹ã€çŸ¥è¯†åœ°å›¾

```
  â‘  ç”Ÿæˆå¹¶ä¿å­˜ â†’ â‘¡ è¯»å–å¹¶æ˜¾ç¤º â†’ â‘¢ çª—å£äº¤äº’ â†’ â‘£ è…èš€è†¨èƒ€
     imwrite       imread         â˜… æœ¬è¯¾        â†‘ ä½¿ç”¨çª—å£+trackbar
                                   namedWindow
                                   imshow
                                   setMouseCallback

  æœ¬è¯¾å¼•å…¥çš„ namedWindow + imshow + waitKey æ¨¡å¼
  æ˜¯åç»­æ‰€æœ‰è¯¾ç¨‹ï¼ˆ04~12ï¼‰çš„æ ‡å‡†æ˜¾ç¤ºæ–¹å¼ã€‚
```

---

## åã€è®°å¿†å£è¯€

```
ğŸ§  çª—å£ä¸‰æ­¥æ›²ï¼š

  "å¼€çª—(named) â†’ è´´å›¾(imshow) â†’ ç­‰é”®(waitKey)"
  ç¼ºä¸€ä¸å¯ï¼ŒwaitKey ä¸è°ƒçª—å£å°±ç™½å¼€

ğŸ§  é¼ æ ‡ç”»çº¿çŠ¶æ€æœºï¼š

  "æŒ‰ä¸‹è®°ç‚¹ï¼Œç§»åŠ¨ç”»çº¿ï¼ŒæŠ¬èµ·åœç¬”"
  LBUTTONDOWN â†’ è®°å½•èµ·ç‚¹
  MOUSEMOVE   â†’ line(ä¸Šä¸€ç‚¹, å½“å‰ç‚¹)
  LBUTTONUP   â†’ åœæ­¢

ğŸ§  å›è°ƒå‡½æ•°å£è¯€ï¼š

  "ä½ æ³¨å†Œï¼Œç³»ç»Ÿè°ƒï¼Œäº”ä¸ªå‚æ•°è·‘ä¸äº†"
  void callback(event, x, y, flags, userdata)
```

---

## åä¸€ã€æ–°æ‰‹é›·åŒº

```cpp
// âŒ é›·åŒº 1ï¼šimshow åä¸è°ƒ waitKey
cv::namedWindow("win");
cv::imshow("win", image);
// çª—å£å¼¹å‡ºä½†ç”»é¢æ˜¯é»‘çš„æˆ–ä¸åˆ·æ–°ï¼

// âœ… æ­£ç¡®
cv::imshow("win", image);
cv::waitKey(0);  // æˆ–åœ¨ Qt ä¸­ç”¨ QTimer + waitKey(1)
```

```cpp
// âŒ é›·åŒº 2ï¼šé¼ æ ‡å›è°ƒä¸­ç›´æ¥è®¿é—® widget æˆå‘˜
void mouseCallback(int event, int x, int y, int flags, void* userdata) {
    myWidget->someField = x;  // å¯èƒ½è·¨çº¿ç¨‹ï¼

// âœ… æ­£ç¡®ï¼šé€šè¿‡ userdata ä¼ é€’æŒ‡é’ˆ
void mouseCallback(int event, int x, int y, int flags, void* userdata) {
    auto* self = static_cast<MyWidget*>(userdata);
    self->handleMouse(event, x, y);
}
```

```cpp
// âŒ é›·åŒº 3ï¼šçª—å£åå­—ä¸ä¸€è‡´
cv::namedWindow("MyWindow");
cv::imshow("mywindow", image);  // å¤§å°å†™ä¸åŒ â†’ åˆ›å»ºäº†ä¸¤ä¸ªçª—å£ï¼

// âœ… æ­£ç¡®ï¼šç”¨å¸¸é‡ä¿å­˜çª—å£å
const std::string WIN = "MyWindow";
cv::namedWindow(WIN);
cv::imshow(WIN, image);
```

---

## åäºŒã€æ€è€ƒé¢˜

1. **ä¸ºä»€ä¹ˆ `waitKey(0)` èƒ½è®©ç¨‹åºæš‚åœï¼Œè€Œ `waitKey(1)` ä¸ä¼šï¼Ÿ**
   æç¤ºï¼šå‚æ•° 0 è¡¨ç¤º"æ— é™ç­‰å¾…"ï¼Œæ­£æ•°è¡¨ç¤º"ç­‰å¾…æ¯«ç§’æ•°åè¶…æ—¶"ã€‚

2. **å¦‚æœä¸è°ƒç”¨ `cv::destroyWindow`ï¼Œç¨‹åºé€€å‡ºæ—¶ä¼šæ€æ ·ï¼Ÿ**
   æç¤ºï¼šæ“ä½œç³»ç»Ÿä¼šå›æ”¶èµ„æºï¼Œä½†å¥½ä¹ æƒ¯æ˜¯ä¸»åŠ¨æ¸…ç†ã€‚

3. **LINE_8 å’Œ LINE_AA çš„çº¿æ¡æœ‰ä»€ä¹ˆè§†è§‰åŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆ AA æ›´æ…¢ï¼Ÿ**
   æç¤ºï¼šAA = Anti-Aliasingï¼Œéœ€è¦è®¡ç®—è¾¹ç¼˜åƒç´ çš„é€æ˜åº¦æ··åˆã€‚

---

## åä¸‰ã€é€ŸæŸ¥å¡ç‰‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ è¯¾ç¨‹ 03 é€ŸæŸ¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                    â”‚
â”‚  åˆ›å»ºçª—å£:                                          â”‚
â”‚    cv::namedWindow("name", WINDOW_NORMAL);         â”‚
â”‚                                                    â”‚
â”‚  æ˜¾ç¤ºå›¾ç‰‡:                                          â”‚
â”‚    cv::imshow("name", mat);                        â”‚
â”‚                                                    â”‚
â”‚  ç­‰å¾…æŒ‰é”®:                                          â”‚
â”‚    int key = cv::waitKey(0);  // æ— é™ç­‰å¾…           â”‚
â”‚    int key = cv::waitKey(30); // 30ms è¶…æ—¶          â”‚
â”‚                                                    â”‚
â”‚  é¼ æ ‡å›è°ƒ:                                          â”‚
â”‚    cv::setMouseCallback("name", callback, data);   â”‚
â”‚    void cb(int event, int x, int y,                â”‚
â”‚            int flags, void* userdata);             â”‚
â”‚                                                    â”‚
â”‚  ç”»çº¿:                                              â”‚
â”‚    cv::line(img, pt1, pt2, color, thick, LINE_AA); â”‚
â”‚                                                    â”‚
â”‚  å…³é—­çª—å£:                                          â”‚
â”‚    cv::destroyWindow("name");                      â”‚
â”‚    cv::destroyAllWindows();                        â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## åå››ã€å»¶ä¼¸é˜…è¯»

- [cv::namedWindow æ–‡æ¡£](https://docs.opencv.org/4.x/d7/dfc/group__highgui.html#ga5afdf8410934fd099df85c75b2e0888b) â€” çª—å£æ ‡å¿—è¯¦è§£
- [cv::setMouseCallback æ–‡æ¡£](https://docs.opencv.org/4.x/d7/dfc/group__highgui.html#ga89e7806b0a616f6f1d502bd8c183ad3e) â€” é¼ æ ‡äº‹ä»¶ç±»å‹å®Œæ•´åˆ—è¡¨
- [OpenCV ç»˜å›¾å‡½æ•°](https://docs.opencv.org/4.x/d6/d6e/group__imgproc__draw.html) â€” line, circle, rectangle, putText ç­‰
